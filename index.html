<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>nehan.js by tategakibunko</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <link href="https://nehan.googlecode.com/hg/nehan5.css" rel="stylesheet">
    <link rel="stylesheet" href="stylesheets/custom.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>nehan.js</h1>
        <p>nehan.js is dynamic layout engine to generate <strong>paged-media</strong> in non-blocking way.</p>
	<p>Supporting not only horizontal layout, but also <strong>vertical</strong> layout.</p>
	<p>Furthermore, <strong>flexible functional css value</strong> is supported, so you can define styles in  very readable and programmable way.</p>

        <p class="view"><a href="https://github.com/tategakibunko/nehan.js">View the Project on GitHub <small>tategakibunko/nehan.js</small></a></p>

        <ul>
          <li><a href="https://github.com/tategakibunko/nehan.js/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/tategakibunko/nehan.js/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/tategakibunko/nehan.js">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>

      <!-- demo -->
      <section>
        <h2><a name="demo" class="anchor" href="#demo"><span class="octicon octicon-link"></span></a>Demo</h2>
	<p>This demo is generated by <a href="https://github.com/tategakibunko/jquery.nehan">jquery.nehan</a>, is easy to use wrapper library of nehan.js.</p>
	
<div class="nehan-book" style="display:none">
<h3>wrap arounding</h3>
<img width="128" height="128" src="images/128x128.gif" class="nehan-float-start nehan-disp-block nehan-gap-end">
<div class="nehan-drop-caps">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
<img width="128" height="128" src="images/128x128.gif" class="nehan-float-end nehan-disp-block">
<div style="break-after:always">lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum</div>
<page-break>

<h3>flip flow</h3>
<p>lorem ipsum dolor sit amet, consectetur adipisicing elit lorem ipsum dolor sit amet, lorem ipsum dolor sit amet, consectetur adipisicing elit lorem ipsum dolor sit amet, consectetur adipisicing elit. lorem ipsum dolor sit amet, consectetur adipisicing elit lorem ipsum dolor sit amet.</p>
<div class="nehan-flow-flip"><div class="nehan-drop-caps">日本国民は正当に選挙された国会における代表者を通じて行動し、われらとわれらの<ruby><rb>子孫</rb><rt>しそん</rt></ruby>のために、諸国民との協和による成果と、わが国全土にわたって自由のもたらす<ruby><rb>恵沢</rb><rt>けいたく</rt></ruby>を確保し、政府の行為によって再び<ruby><rb>戦争</rb><rt>せんそう</rt></ruby>の<ruby><rb>惨禍</rb><rt>さんか</rt></ruby>が起ることのないやうにすることを決意し、ここに<ruby><rb>主権</rb><rt>しゅけん</rt></ruby>が国民に存することを宣言し、この憲法を確定する。<ruby>日本<rt>にほん</rt></ruby>国民は正当に<ruby>選挙<rt>せんきょ</rt></ruby>された<ruby>国会<rt>こっかい</rt></ruby>における代表者を通じて行動し、われらとわれらの<ruby><rb>子孫</rb><rt>しそん</rt></ruby>のために、諸国民との協和による成果と、わが国全土にわたって自由のもたらす<ruby><rb>恵沢</rb><rt>けいたく</rt></ruby>を確保し、政府の行為によって再び<ruby><rb>戦争</rb><rt>せんそう</rt></ruby>の<ruby><rb>惨禍</rb><rt>さんか</rt></ruby>が起ることのないやうにすることを決意し、ここに<ruby><rb>主権</rb><rt>しゅけん</rt></ruby>が国民に存することを宣言し、この憲法を確定する。</div></div>
<page-break>
<h3>list paging</h3>
<ul>
  <li>first</li>
  <li>second
    <ol>
      <li>lorem ipsum dolor sit amet, consectetur adipisicing elit lorem ipsum dolor sit amet, consectetur adipisicing elit</li>
      <li>abc ded ghi</li>
    </ol>
  </li>
  <li>last</li>
</ul>
<page-break>

<h3>table paging</h3>
<p>Even if table layout can be pagerize!!</p>
<table>
<thead><tr><th>head1</th><th>head2</th></tr></thead>

<tbody>
<tr>
<td>lorem ipsum dolor sit amet consectetur adipisicing elit</td>
<td>lorem ipsum dolor sit amet consectetur adipisicing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua Ut enim ad minim veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat</td>
</tr>

<tr><td>body3</td><td>body4</td></tr>
<tr><td>body5</td><td>body6</td></tr>
<tr><td>body7</td><td>body8</td></tr>
</tbody>

<tfoot><tr><td>foot1</td><td>foot2</td></tr></tfoot>
</table>
<page-break>

<h3>page break</h3>
first page
<page-break>
second page
<page-break>

<h3>image push</h3>
<img src="images/256x256.gif" class="nehan-disp-block" width="256" height="256" pushed>
<p><code>img</code> with <b>pushed</b> attribute, you can push image at the tail of page.</p>
<p>lorem ipsum dolor sit amet, consectetur adipisicing elit lorem ipsum dolor sit amet, consectetur adipisicing elit</p>
<page-break>

<h3>font size</h3>
<p><span class="nehan-larger">larger</span></p>
<p><span class="nehan-smaller">smaller</span></p>
<p><span class="nehan-xx-small">xx-small</span></p>
<p><span class="nehan-x-small">x-small</span></p>
<p><span class="nehan-small">small</span></p>
<p><span class="nehan-medium">normal</span></p>
<p><span class="nehan-large">large</span></p>
<p><span class="nehan-x-large">x-large</span></p>
<p><span class="nehan-xx-large">xx-large</span></p>
<page-break>

<h3>text align</h3>
<p class="nehan-ta-start">aligned to start</p>
<p class="nehan-ta-center">aligned to center</p>
<p class="nehan-ta-end">aligned to end</p>
<page-break>

<h3>text combine</h3>
<div class="nehan-flow-flip">
平成<span class='nehan-tcy'>25</span>年<span class='nehan-tcy'>1</span>月<span class='nehan-text-combine'>10</span>日
</div>

<h3>text emphasis</h3>
<p>これは<span class='nehan-empha-dot-filled'>黒ドット</span>です。</p>
<p>これは<span class='nehan-empha-dot-open'>白ドット</span>です。</p>
<p>これは<span class='nehan-empha-circle-filled'>黒丸</span>です。</p>
<p>これは<span class='nehan-empha-circle-open'>白丸</span>です。</p>
<p>これは<span class='nehan-empha-double-circle-filled'>黒の蛇の目</span>です。</p>
<p>これは<span class='nehan-empha-double-circle-open'>二重丸</span>です。</p>
<p>これは<span class='nehan-empha-triangle-filled'>黒三角</span>です。</p>
<p>これは<span class='nehan-empha-triangle-open'>白三角</span>です。</p>
<p>これは<span class='nehan-empha-sesame-filled'>黒ゴマ</span>です。</p>
<p>これは<span class='nehan-empha-sesame-open'>白ゴマ</span>です。</p>

</div><!-- nehan-book -->
      </section><!-- demo -->

      <!-- getting started -->
      <section>
        <h2><a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<ol>
  <li>
    <h3>Include css, js in the <code>&lt;head&gt;</code>.</h3>
<pre class="prettyprint lang-html">
&lt;link href="/path/to/nehan.css" type="text/css" rel="stylesheet"&gt;
&lt;script src="/path/to/nehan.js" type="text/javascript"&gt;&lt;/script&gt;
</pre>
  </li>

  <li>
    <h3>Generate layout engine with layout settings.</h3>
<pre class="prettyprint lang-js">
var engine = Nehan.setup({
   layout:{
      direction:"hori", // or "vert"
      vert:"tb-rl", // or "tb-lr"
      hori:"lr-tb",
      fontSize:16,
      width: 640,
      height: 480
   }
});
</pre>
</li>

  <li>
    <h3>Setting styles</h3>
    <p>Your own styles can be defined by using <code>setStyle</code>(or setStyles).</p>
    <p>See <a href="#styling">styling</a> for more details.</p>
<pre class="prettyprint lang-js">
engine.setStyles({
  // always break the page before h1.
  "h1":{
    "break-before":"always",
    "font-size":"32px"
  },
  // if external link, highlight background-color.
  "a[href^=#]":{
    "background-color":"gold"
  },
  // make first-letter larger and floated to start.
  // notice that in nehan.js, all class names must be started with 'nehan-'.
  ".nehan-drop-caps::first-letter":{
    "display":"inline-block",
    "box-sizing":"content-box",
    "float":"start",
    "font-size":"4em",
    "extent":"1em"
  },
  // functional value
  // context:SelectorContext
  ".nehan-stripe-list li":{
    "background-color":function(context){
      return (context.getChildIndex() % 2 === 0)? "pink" : "white";
    }
  },
  // special callback argument 'onload', called after loading all css about this selector.
  // context:SelectorCallbackContext
  ".nehan-must-be-square img":{
    "onload":function(context){
      var width = context.getCssAttr("width", 100);
      var height = context.getCssAttr("height", 100);
      if(width !== height){
	var larger = Math.max(width, height);
	return {width:larger, height:larger};
      }
    }
  }
});
</pre>
  </li>

  <li>
    <h3>Create page stream</h3>

<pre class="prettyprint lang-js">
var stream = engine.createPageStream("hello, nehan.js!");
</pre>
  </li>

  <li>
    <h3>Yielding page</h3>
    <p>Stream is created, now you can yield paged-media by <code>asyncGet</code>.</p>
<pre class="prettyprint lang-js">
stream.asyncGet({
  // called when each single pages are successfully calculated.
  onProgress : function(stream, tree){
    var page = stream.getPage(tree.pageNo); // get page object of this page.
    console.log(page.html);
  },
  onComplete : function(stream, time){
    console.log("finished! %f msec", time);
    // you can create outline element via engine.documentContext.
    var toc = engine.documentContext.createBodyOutlineElement({
      onClickLink : function(toc){
        console.log("click toc:%o", toc);
      }
    });
  }
});
</pre>
  </li>
</ol>
      </section><!-- getting started -->

      <!-- styling -->
      <section>
        <h2><a name="styling" class="anchor" href="#styling"><span class="octicon octicon-link"></span></a>Styling</h2>

	<h3>Important notices about styling in nehan.js</h3>

	<p>As you see at previous chapter(Getting Started), your own style can be defined by <strong>setStyle</strong>(or setStyles).</p>
	<p>But notice that there are some local rules in nehan.js.</p>

	<ol>
	  <li>
	    <h4>not all properties is supported.</h4>
	    <p>See <a href="#css-properties">supported properties</a>.</p>
	  </li>

	  <li>
	    <h4>camel case property is not allowed</h4>
<pre class="prettyprint lang-js">
{font-size:"16px"} // OK
{fontSize:"16px"}  // NG!
</pre>
	  </li>

	  <li>
	    <h4>some properties are defined by 'logical' value</h4>
	    <p>Assume that Layout.direction is "hori" and Layout["hori"] is "lr-tb".</p>
<pre class="prettyprint lang-js">
{margin:{before:"10px"}} // same as {margin:{top:"10px"}}
{float:"start"} // same as {float:"left"}.
{measure:"100px", extent:"50px"} // same as {width:"100px", height:"50px"}
</pre>
	  </li>

	  <li>
	    <h4>all class names must be started with "nehan-" prefix.</h4>
	    <p>to avoid css collision that is not layouted by nehan.js, our css names must be prefixed by <code>"nehan-"</code>.</p>
	  </li>

	  <li>
	    <h4>about functional css value</h4>
	    <p>you can use functional css value in each css property.</p>
	    <ol>
	      <li>
		<h5>callback argument 'context' in functional css value is 'SelectorContext'</h5>
<pre class="prettyprint lang-js">
// change backgroiund-color by child index.
".nehan-stripe-list li":{
  "background-color":function(context){
    return (context.getChildIndex() % 2 === 0)? "pink" : "white";
  }
}
</pre>
	      </li>
	      <li>
		<h5>callback argument 'context' in 'onload' is 'SelectorCallbackContext'</h5>
		<p>this context is 'extended class' of 'SelectorContext', with some extra interfaces</p>
		<p>that can touch css object, because 'onload' is called after all css of matched elements are loaded.</p>
		<pre class="prettyprint lang-js">
// force image metrics to square sizing if width and height is not same.
".nehan-must-be-square img":{
  "onload":function(context){
    var width = context.getCssAttr("width", 100);
    var height = context.getCssAttr("height", 100);
    if(width !== height){
      var larger = Math.max(width, height);
      return {width:larger, height:larger};
    }
  }
}
		</pre>
	      </li>
	    </ol>
	  </li>

	  <li><h4>special properties in nehan.js</h4>
	    <ol>
	      <li>
		<h5>line-rate:(float)</h5>
		<p>In normal html, size of 'line-height:1.0em' is determined by font size of 'parent' block.</p>
		<p>In contrast, property <strong>line-rate</strong> is determined by max font size of 'current line'.</p>
		<p>Assume that font-size of parent block is 16px, and max font size of current line is 32px, line-height:1.0em is 16px, but line-rate:1.0em is 32px.</p>
	      </li>
	      
	      <li>
		<h5>box-sizing:[content-box | border-box | margin-box(default)]</h5>
		<p>In box-sizing, <strong>margin-box</strong> is special value in nehan.js, and is box-sizing default value.</p>
		<p>In margin-box, even if margin is included in box-size.</p>
		<p>Why? In normal html, outer size of box can be expanded, but in paged layout, outer size is strictly fixed.</p>
		<p>So if you represent margin/border/padding(called in edge in nehan.js), the only way is 'eliminating content space'.</p>
	      </li>

	      <li>
		<h5>flow:[lr-tb | tb-rl | tb-lr | flip]</h5>
		<p>This property represent document-mode in nehan.js.</p>
		<p><code>lr-tb</code> means inline flows 'left to right', block flows 'top to bottom'.</p>
		<p><code>tb-rl</code> means inline flows 'top to bottom', block flows 'right to left', and so on.</p>
		<p><code>flip</code> means toggle Layout["hori"] and Layout["vert"].</p>
		<p>for example, assume that Layout["hori"] is "lr-tb", and Layout["vert"] is "tb-rl",</p>
		<p>and current document direction(Layout.direction) is "hori", flow:"flip" means "tb-rl".</p>
	      </li>
	    </ol>
	  </li>
	</ol>


	<a name="css-properties"></a>
	<h3>supported css properties</h3>
	<p>here is all supported css properties in nehan.js</p>

	<table>
	  <thead><tr><th>property</th><th>example</th><th>description</th></tr></thead>
	  <tbody>
	    <!-- a --->
	    <!-- b --->
	    <tr>
	      <td>background-color</td>
	      <td>
		<p>{"background-color":"pink"}</p>
		<p>{"background-color":"#FF0000"}</p>
	      </td>
	      <td></td>
	    </tr>

	    <tr>
	      <td>border-width</td>
	      <td>
		<p>{"border-width":{"after":"1px"}}</p>
	      </td>
	      <td></td>
	    </tr>

	    <tr>
	      <td>border-style</td>
	      <td>
		<p>{"border-style":"solid"}</p>
	      </td>
	      <td></td>
	    </tr>

	    <tr>
	      <td>box-sizing</td>
	      <td><p>{"box-sizing":"content-box"}</p></td>
	      <td></td>
	    </tr>

	    <tr>
	      <td>break-after</td>
	      <td>
		<p>{"break-after":"always"}</p>
		<p>{"break-after":"avoid"}</p>
	      </td>
	      <td>use for page breaking</td>
	    </tr>

	    <tr>
	      <td>break-before</td>
	      <td>
		<p>{"break-before":"always"}</p>
		<p>{"break-before":"avoid"}</p>
	      </td>
	      <td>use for page breaking</td>
	    </tr>


	    <!-- c --->
	    <tr>
	      <td>color</td>
	      <td>
		<p>{"color":"red"}</p>
		<p>{"color":"#0000FF"}</p>
	      </td>
	      <td></td>
	    </tr>

	    <!-- d --->
	    <tr>
	      <td>display</td>
	      <td><p>{"display":"block"}</p></td>
	      <td></td>
	    </tr>

	    <!-- e --->
	    <tr>
	      <td>extent</td>
	      <td></td>
	      <td>
		<p>size of block direction.</p>
		<p>If flow is "lr-tb", extent is same as "height".</p>
		<p>But if flow is "tb-rl", extent is same as "width".</p>
	      </td>
	    </tr>

	    <!-- f --->
	    <tr>
	      <td>float</td>
	      <td>
		<p>{"float":"start"}</p>
		<p>{"float":"end"}</p>
	      </td>
	      <td>'center' is not supported yet.</td>
	    </tr>

	    <tr>
	      <td>flow</td>
	      <td>
		<p>{"flow":"tb-rl"}</p>
	      </td>
	      <td>
		<p>lr-tb | tb-rl | rb-lr is enabled.</p>
		<p>rl-tb is not supported yet.</p>
	      </td>
	    </tr>


	    <tr>
	      <td>font-size</td>
	      <td>
		<p>{"font-size":"1em"}</p>
		<p>{"font-size":"18px"}</p>
		<p>{"font-size":"12pt"}</p>
	      </td>
	      <td></td>
	    </tr>

	    <tr>
	      <td>font-family</td>
	      <td>
		<p>{"font-family":"Meiryo, monospace"}</p>
	      </td>
	      <td></td>
	    </tr>

	    <tr>
	      <td>font-weight</td>
	      <td><p>{"font-weight":"bold"}</p></td>
	      <td></td>
	    </tr>

	    <tr>
	      <td>font-style</td>
	      <td>
		<p>{"font-style":"italic"}</p>
		<p>{"font-style":"normal"}</p>
	      </td>
	      <td></td>
	    </tr>

	    <!-- g --->
	    <!-- h --->
	    <tr>
	      <td>height</td>
	      <td>
		<p>{"height":"100px"}</p>
		<p>{"height":"1em"}</p>
		<p>{"height":"90%"}</p>
	      </td>
	      <td></td>
	    </tr>

	    <!-- i --->
	    <!-- j --->
	    <!-- k --->
	    <!-- l --->
	    <tr>
	      <td>line-rate</td>
	      <td><p>{"line-rate":"2.0em"}</p></td>
	      <td>this is nehan.js original property.</td>
	    </tr>

	    <tr>
	      <td>list-style-type</td>
	      <td>
		<p>{"list-style-type":"decimal"}</p>
		<p>{"list-style-type":"disc"}</p>
		<p>{"list-style-type":"lower-alpha"}</p>
	      </td>
	      <td>see style.js and search ".nehan-lst-xxx" to find other availables.</td>
	    </tr>

	    <!-- m --->
	    <tr>
	      <td>margin</td>
	      <td>
		<p>{"margin":{"after":"10px"}}</p>
	      </td>
	      <td></td>
	    </tr>

	    <tr>
	      <td>measure</td>
	      <td></td>
	      <td>
		<p>size of inline direction.</p>
		<p>If flow is "lr-tb", measure is same as "width".</p>
		<p>But if flow is "tb-rl", measure is same as "height".</p>
	      </td>
	    </tr>

	    <!-- n --->
	    <!-- o --->
	    <!-- p --->
	    <tr>
	      <td>padding</td>
	      <td>
		<p>{"margin":{"start":"5px", "end":"5px"}}</p>
	      </td>
	      <td></td>
	    </tr>

	    <!-- q --->
	    <!-- r --->
	    <!-- s --->
	    <!-- t --->
	    <tr>
	      <td>text-align</td>
	      <td>
		<p>{"text-align":"start"}</p>
		<p>{"text-align":"center"}</p>
		<p>{"text-align":"end"}</p>
	      </td>
	      <td>start | center | end</td>
	    </tr>

	    <tr>
	      <td>text-combine</td>
	      <td>
		<p>{"text-combine":"horizontal"}</p>
	      </td>
	      <td>now "horizontal" only</td>
	    </tr>

	    <tr>
	      <td>text-emphasis-style</td>
	      <td>
		<p>{"text-emphasis-style":"open dot"}</p>
		<p>{"text-emphasis-style":"filled dot"}</p>
	      </td>
	      <td>start | center | end</td>
	    </tr>

	    <!-- u --->
	    <!-- v --->
	    <!-- w --->
	    <tr>
	      <td>white-space</td>
	      <td>
		<p>{"white-space":"normal"}</p>
		<p>{"white-space":"pre"}</p>
	      </td>
	      <td></td>
	    </tr>

	    <tr>
	      <td>width</td>
	      <td>
		<p>{"width":"100px"}</p>
		<p>{"width":"1em"}</p>
		<p>{"width":"90%"}</p>
	      </td>
	      <td></td>
	    </tr>

	    <!-- x --->
	    <!-- y --->
	    <!-- z --->
	  </tbody>
	</table>

      </section>

      <!-- license -->
      <section>
        <h2><a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>
	<p>licensed under MIT.</p>
      </section>

      <footer>
        <p>This project is maintained by <a href="https://github.com/tategakibunko">tategakibunko</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>

    <script src="javascripts/scale.fix.js"></script>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
    <script type="text/javascript" src="https://nehan.googlecode.com/hg/nehan5.min.js"></script>
    <script type="text/javascript" src="https://nehan.googlecode.com/hg/jquery.nehan.min.js"></script>
    <script src="javascripts/custom.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-399060-28', 'tategakibunko.github.io');
      ga('send', 'pageview');
    </script>
  </body>
</html>
